# 交易日志打印模板 - MT5 外汇黄金交易版本
# -*- coding: utf-8 -*-

import sys
import io

# Windows 下启用 UTF-8 输出
if sys.platform == 'win32':
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')

"""
基于 Crypto 交易机器人改进的外汇黄金日志打印模板
术语对应关系:
  - 币名 -> 品种 (Symbol: XAUUSD 等)
  - 交易所 -> 经纪商 (Broker: STARTRADER 等)
  - 杠杆倍数 -> 杠杆比例 (如 1:500)
  - 投入保证金 -> 占用保证金 (Used Margin)
  - 杠杆后货值 -> 名义价值/合约价值 (Notional Value)
  - 下单数量(USDT) -> 交易手数 (Lots)
"""

def 打印开仓日志(KOL名称, 品种, 方向, 经纪商, 账户信息, 交易参数):
    """
    打印完整的开仓交易日志

    参数说明:
    - KOL名称: 信号来源
    - 品种: XAUUSD / EURUSD 等
    - 方向: "做多" 或 "做空"
    - 经纪商: "STARTRADER" / "Exness" 等
    - 账户信息: {
        "总资产": float,          # 总账户净值 (USD)
        "可用余额": float,        # 可用保证金 (USD)
        "可用百分比": float,      # 可用占比 (%)
        "风险率": float           # 占用风险率 (%)
      }
    - 交易参数: {
        "手数": float,            # 交易手数 (Lots)
        "入场价": float,          # 开仓价格
        "止损价": float,          # 止损价格
        "止损幅": float,          # 止损幅度 (%)
        "止盈目标": list,         # [TP1, TP2, TP3...] 止盈价位列表
        "名义价值": float,        # 合约名义价值 (USD)
        "占用保证金": float,      # 所需保证金 (USD)
        "杠杆比例": str,          # "1:500" 等
        "KOL权重": float          # KOL 信号权重系数 (0.0 ~ 1.0)
      }
    """

    # 计算盈亏数据
    stop_distance = abs(交易参数["入场价"] - 交易参数["止损价"])
    risk_reward_ratio = (交易参数["止盈目标"][0] - 交易参数["入场价"]) / stop_distance if 交易参数["止盈目标"] else 0

    方向符号 = "📈做多" if 方向 == "做多" else "📉做空"

    # === 第一行: 时间戳 + 信号来源 ===
    print("[19:17:13]")
    print("=" * 80)

    # === 第二行: KOL 信号头 ===
    print(f"👤 [{KOL名称}] 💠指令: 开仓 🟡品种: {品种} | {方向符号} | 🏦 {经纪商}")
    print(f"[19:17:13] 🔍 [准备开仓] 品种: {品种}")

    # === 杠杆与头寸参数 ===
    print(f"🛠 杠杆: {交易参数['杠杆比例']} | 止损幅 {交易参数['止损幅']:.2f}% | KOL权重 {交易参数['KOL权重']:.1f}")

    # === 资金占用 ===
    风险占比 = (交易参数['占用保证金'] / 账户信息['总资产']) * 100
    剩余占比 = 100.0 - 账户信息['可用百分比'] + 风险占比

    print(f"💰 总资产: {账户信息['总资产']:.2f} | 可用: {账户信息['可用余额']:.2f} USD " +
          f"({账户信息['可用百分比']:.2f}% - {风险占比:.2f}% = {100.0 - 风险占比:.2f}%)")
    print(f"💵 占用保证金: {交易参数['占用保证金']:.2f} USD (⏱{风险占比:.2f}%)")
    print(f"📦 名义价值: {交易参数['名义价值']:.2f} USD (⏱{(交易参数['名义价值']/账户信息['总资产'])*100:.2f}%)")

    # === 价格与止盈止损 ===
    # 格式化止盈价位和盈利点数
    tp_display_list = []
    for tp in 交易参数["止盈目标"]:
        profit_points = tp - 交易参数['入场价']
        tp_display_list.append(f"{tp:.4f}(+{profit_points:.1f})")
    tp_display = " ".join(tp_display_list) if tp_display_list else "无"

    print(f"🔄 均价: {交易参数['入场价']:.4f} 🥇止盈: {tp_display} ☠️止损: " +
          f"{交易参数['止损价']:.4f}({-stop_distance:.3f}) | ⚖️ 盈亏比: {risk_reward_ratio:.1f}R")

    # === 执行手数 ===
    print(f"📄 执行挂单 (交易手数):")
    print(f"      [1] ⏳ 开仓价 {交易参数['入场价']:.2f} | 💸{交易参数['手数']:.2f}手")

    # === 底部分隔符 ===
    print("✅ 部署完毕 (1单)")
    print("=" * 80)


# ===========================
# 示例使用
# ===========================
if __name__ == "__main__":
    # 模拟数据 - XAUUSD 黄金做多
    KOL_NAME = "黄金帝国"
    SYMBOL = "XAUUSD"
    DIRECTION = "做多"
    BROKER = "STARTRADER"

    账户数据 = {
        "总资产": 1147.66,
        "可用余额": 1136.37,
        "可用百分比": 99.02,
        "风险率": 2.10
    }

    交易数据 = {
        "手数": 0.1,
        "入场价": 2030.50,
        "止损价": 2020.00,
        "止损幅": 0.52,
        "止盈目标": [2040.50, 2050.50, 2070.50],
        "名义价值": 20305.00,  # 0.1手 * 2030.50价格 * 100 (黄金合约单位) / 1000 实际
        "占用保证金": 40.61,    # 根据 1:500 杠杆比例计算
        "杠杆比例": "1:500",
        "KOL权重": 0.7
    }

    打印开仓日志(KOL_NAME, SYMBOL, DIRECTION, BROKER, 账户数据, 交易数据)

    print("\n\n")
    print("=" * 80)
    print("【示例2】EURUSD 做空信号")
    print("=" * 80 + "\n")

    # 模拟数据 - EURUSD 做空
    交易数据2 = {
        "手数": 0.2,
        "入场价": 1.0850,
        "止损价": 1.0900,
        "止损幅": 0.46,
        "止盈目标": [1.0800, 1.0750],
        "名义价值": 21700.00,  # 0.2手 * 1.0850价格 * 100000 (货币对合约单位)
        "占用保证金": 43.40,   # 根据 1:500 杠杆比例计算
        "杠杆比例": "1:500",
        "KOL权重": 0.8
    }

    打印开仓日志("欧美智者", "EURUSD", "做空", "STARTRADER", 账户数据, 交易数据2)
