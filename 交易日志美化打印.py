# äº¤æ˜“ç³»ç»Ÿç¾åŒ–æ—¥å¿—æ‰“å°æ¨¡å—
# -*- coding: utf-8 -*-

import sys
import io
import datetime

# Windows ä¸‹å¯ç”¨ UTF-8 è¾“å‡º
if sys.platform == 'win32':
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8', line_buffering=True)

"""
ç»Ÿä¸€çš„äº¤æ˜“æ—¥å¿—æ‰“å°æ¨¡å—ï¼Œç”¨äºå†³ç­–ç«¯å’Œæ‰§è¡Œç«¯
æä¾›ç¾åŒ–çš„ã€æ ¼å¼åŒ–çš„æ—¥å¿—è¾“å‡º
"""

class äº¤æ˜“æ—¥å¿—æ‰“å°å™¨:
    """ç»Ÿä¸€çš„äº¤æ˜“ç³»ç»Ÿæ—¥å¿—æ‰“å°å·¥å…·"""

    # ==========================================
    # ğŸ‘‡ğŸ‘‡ğŸ‘‡ æ–°å¢åŒºåŸŸï¼šå®šåˆ¶çš„ç´§å‡‘ç‰ˆå‡½æ•° ğŸ‘‡ğŸ‘‡ğŸ‘‡
    # ==========================================

    @staticmethod
    def è·å–æ—¶é—´():
        """è·å–å½“å‰æ—¶é—´å­—ç¬¦ä¸² HH:MM:SS"""
        return datetime.datetime.now().strftime("%H:%M:%S")

    @staticmethod
    def å†³ç­–_æ”¶åˆ°ä¿¡å·_ç´§å‡‘ç‰ˆ(KOLåç§°, å›¾ç‰‡æ•°):
        """æ–°ç‰ˆå¤´éƒ¨ï¼šåŒ…å«æ—¶é—´ã€KOLã€å›¾ç‰‡æ•°"""
        t = äº¤æ˜“æ—¥å¿—æ‰“å°å™¨.è·å–æ—¶é—´()
        print(f"\n[å‘ç°ä¿¡å·] {t}", flush=True)
        print("=" * 45, flush=True)
        print(f"kol:{KOLåç§°:<10} | å›¾ç‰‡: {å›¾ç‰‡æ•°}å¼ ", flush=True)
        #print("ç­‰å¾…AIåˆ†æ.....", flush=True)

    @staticmethod
    def å†³ç­–_AIç»“æœ_æç¤º(è€—æ—¶_ç§’=0):
        """æ–°ç‰ˆï¼šä»…æ˜¾ç¤ºè€—æ—¶æç¤º"""
        time_str = f"({è€—æ—¶_ç§’:.2f}s)" if è€—æ—¶_ç§’ > 0 else ""
        print(f"\næ”¶åˆ°ç»“æœ{time_str}...", flush=True)

    @staticmethod
    def å†³ç­–_æ˜¾ç¤ºæ˜ å°„(åŸå§‹å“ç§, æ˜ å°„åå“ç§):
        """æ–°ç‰ˆï¼šæ˜¾ç¤ºå“ç§æ˜ å°„"""
        print(f"[Debug-æ˜ å°„] ç²¾ç¡®åŒ¹é…: {åŸå§‹å“ç§} -> {æ˜ å°„åå“ç§}", flush=True)

    @staticmethod
    def å†³ç­–_ä¿¡å·è¯¦æƒ…_ç´§å‡‘ç‰ˆ(KOLåç§°, å“ç§, æ–¹å‘, å…¥åœºä»·, æ­¢æŸ, TPåˆ—è¡¨, æ˜¯å¸‚ä»·å•=False):
        """æ–°ç‰ˆï¼šæ ¸å¿ƒä¸¤è¡Œä¿¡æ¯ (3ä½å°æ•°)"""
        # å›¾æ ‡å¤„ç†
        æ–¹å‘å›¾æ ‡ = "ğŸ“ˆ" if "åšå¤š" in æ–¹å‘ else "ğŸ“‰" if "åšç©º" in æ–¹å‘ else "âŒ"
        æ–¹å‘æ–‡æœ¬ = f"{æ–¹å‘å›¾æ ‡}{æ–¹å‘}"
        
        # æ­¢æŸå¹…è®¡ç®—
        if å…¥åœºä»· > 0 and æ­¢æŸ > 0:
            å¹… = abs((å…¥åœºä»· - æ­¢æŸ) / å…¥åœºä»· * 100)
            æ­¢æŸå¹…_str = f"{å¹…:.2f}%"
        else:
            æ­¢æŸå¹…_str = "0.00%"

        # ä»·æ ¼æ˜¾ç¤º
        ä»·æ ¼_str = f"{å…¥åœºä»·:<.4f}"
        if æ˜¯å¸‚ä»·å•:
            ä»·æ ¼_str = f"{å…¥åœºä»·:.4f}(å¸‚ä»·)"

        # ç¬¬ä¸€è¡Œ
        print(f"\nKOL : {KOLåç§°:<10} |  å“ç§: {å“ç§:<10} | {æ–¹å‘æ–‡æœ¬}  | {len(TPåˆ—è¡¨)}ä¸ªæ­¢ç›ˆç‚¹", flush=True)
        # ç¬¬äºŒè¡Œ
        print(f"å…¥åœºä»·: {ä»·æ ¼_str:<18} | æ­¢æŸ: {æ­¢æŸ:<.4f} (æ­¢æŸå¹… {æ­¢æŸå¹…_str})", flush=True)

    @staticmethod
    def å†³ç­–_æ‹†å•è®¡åˆ’_ç´§å‡‘ç‰ˆ(æ‹†å•ç»“æœ, æ€»æ‰‹æ•°, ç»Ÿä¸€æ­¢æŸ):
        """æ–°ç‰ˆï¼šæ‹†å•åˆ—è¡¨"""
        print(f"ğŸ“‹ [æ‹†å•è®¡åˆ’] å…± {len(æ‹†å•ç»“æœ)} å• | {æ€»æ‰‹æ•°}æ‰‹ :", flush=True)
        
        sl_str = f"{ç»Ÿä¸€æ­¢æŸ:.4f}" if ç»Ÿä¸€æ­¢æŸ > 0 else "0"

        for i, plan in enumerate(æ‹†å•ç»“æœ, 1):
            tp_val = plan['tp']
            vol = plan['æ‰‹æ•°']
            
            # å¯¹é½æ ¼å¼: æ­¢ç›ˆ1, æ­¢ç›ˆ2...
            print(f"   [{i}] {vol:.2f}æ‰‹ | æ­¢ç›ˆ{i}: {tp_val:<8.4f} | æ­¢æŸ:{sl_str}", flush=True)
        
        print(flush=True) # ç»“æŸç©ºä¸€è¡Œ

    # ==========================================
    # ğŸ‘†ğŸ‘†ğŸ‘† æ–°å¢ç»“æŸ (ä¸‹æ–¹ä¸ºæ—§å‡½æ•°) ğŸ‘†ğŸ‘†ğŸ‘†
    # ==========================================

    @staticmethod
    def å†³ç­–_æ”¶åˆ°ä¿¡å·(KOLåç§°, å“ç§, æ–¹å‘, å›¾ç‰‡æ•°):
        """å†³ç­–ç«¯æ¥æ”¶åˆ°ä¿¡å·æ—¶ (æ—§ç‰ˆ)"""
        æ–¹å‘_æ˜¾ç¤º = "ğŸ“ˆåšå¤š" if "åšå¤š" in æ–¹å‘ else "ğŸ“‰åšç©º" if "åšç©º" in æ–¹å‘ else "âŒå¹³ä»“"
        å›¾ç‰‡_æ˜¾ç¤º = f"ğŸ–¼ï¸ {å›¾ç‰‡æ•°}å¼ " if å›¾ç‰‡æ•° > 0 else "ğŸ“„ çº¯æ–‡æœ¬"

        print(f"\n[ä¿¡å·è¾“å…¥]", flush=True)
        print("=" * 80, flush=True)
        print(f"ğŸ‘¤ KOL: {KOLåç§°:12} | å“ç§: {å“ç§:10} | {æ–¹å‘_æ˜¾ç¤º:6} | {å›¾ç‰‡_æ˜¾ç¤º}", flush=True)
        return

    @staticmethod
    def å†³ç­–_AIåˆ†æä¸­(è€—æ—¶_ç§’=None):
        """AIåˆ†æä¸­ (æ—§ç‰ˆ)"""
        è€—æ—¶_æ–‡æœ¬ = f" ({è€—æ—¶_ç§’:.2f}s)" if è€—æ—¶_ç§’ is not None else ""
        print(f"ğŸ§  AI æ­£åœ¨æ€è€ƒ{è€—æ—¶_æ–‡æœ¬}...", flush=True)
        return

    @staticmethod
    def å†³ç­–_åˆ†æç»“æœ(å“ç§, æ–¹å‘, æ¨¡å¼, å…¥åœºä»·, æ­¢æŸ, TPåˆ—è¡¨):
        """AIåˆ†æç»“æœ (æ—§ç‰ˆ)"""
        æ­¢æŸå¹… = abs((å…¥åœºä»· - æ­¢æŸ) / å…¥åœºä»· * 100) if å…¥åœºä»· > 0 else 0
        TPæ•° = len(TPåˆ—è¡¨)

        print(f"âœ… AIä¿¡å·æ•è·:", flush=True)
        print(f"   ğŸ¯ {å“ç§} {æ–¹å‘} | æ¨¡å¼: {æ¨¡å¼}", flush=True)
        print(f"   ğŸ“ å…¥åœº: {å…¥åœºä»·:.4f} | SL: {æ­¢æŸ:.4f} (æ­¢æŸå¹… {æ­¢æŸå¹…:.2f}%)", flush=True)
        print(f"   ğŸ æ­¢ç›ˆ: {TPæ•°} ä¸ªç›®æ ‡ -> {', '.join([f'{tp:.4f}' for tp in TPåˆ—è¡¨[:3]])}", flush=True)
        return

    @staticmethod
    def å†³ç­–_æ‰‹æ•°è®¡ç®—(å“ç§, æ€»æ‰‹æ•°, è´¦æˆ·ä½™é¢, å…è®¸äºæŸ, æœ€å°æ‰‹, æœ€å¤§æ‰‹):
        """æ‰‹æ•°è®¡ç®—ç»“æœ (æ—§ç‰ˆ)"""
        ä½¿ç”¨ç‡ = (å…è®¸äºæŸ / è´¦æˆ·ä½™é¢ * 100) if è´¦æˆ·ä½™é¢ > 0 else 0

        print(f"ğŸ§® [ä»¥æŸå®šä»“è®¡ç®—]", flush=True)
        print(f"   ğŸ’° è´¦æˆ·ä½™é¢: ${è´¦æˆ·ä½™é¢:.0f} | é£é™©: {ä½¿ç”¨ç‡:.2f}% (${å…è®¸äºæŸ:.1f})", flush=True)
        print(f"   ğŸ“Š æ‰‹æ•°é™åˆ¶: {æœ€å°æ‰‹}~{æœ€å¤§æ‰‹} æ‰‹ | è®¡ç®—ç»“æœ: {æ€»æ‰‹æ•°}æ‰‹", flush=True)
        return

    @staticmethod
    def å†³ç­–_æ‹†å•è®¡åˆ’(æ‹†å•ç»“æœ):
        """æ‹†å•è®¡åˆ’ (æ—§ç‰ˆ)"""
        print(f"ğŸ“‹ [æ‹†å•è®¡åˆ’] å…± {len(æ‹†å•ç»“æœ)} å•:", flush=True)
        for i, plan in enumerate(æ‹†å•ç»“æœ, 1):
            tp_text = f"TP: {plan['tp']:.4f}" if plan['tp'] > 0 else "TP: æ— "
            print(f"   [{i}] {plan['æ‰‹æ•°']:.2f}æ‰‹ | {tp_text}", flush=True)
        return

    @staticmethod
    def å†³ç­–_å®Œæˆ(KOLåç§°, å“ç§, æ€»æ‰‹æ•°, æ‹†å•æ•°, çˆ¶ID):
        """å†³ç­–å®Œæˆ (æ—§ç‰ˆ)"""
        print(f"âœ¨ [å†³ç­–å®Œæ¯•]", flush=True)
        print(f"   {KOLåç§°} | {å“ç§} | {æ€»æ‰‹æ•°}æ‰‹æ‹†æˆ {æ‹†å•æ•°}å•", flush=True)
        print(f"   ä¿¡å·ID: {çˆ¶ID}", flush=True)
        print("=" * 80 + "\n", flush=True)
        return

    @staticmethod
    def å†³ç­–_é”™è¯¯(é”™è¯¯ä¿¡æ¯, è¿½è¸ªä¿¡æ¯=None):
        """å†³ç­–é”™è¯¯"""
        print(f"âŒ [å†³ç­–é”™è¯¯] {é”™è¯¯ä¿¡æ¯}", flush=True)
        if è¿½è¸ªä¿¡æ¯:
            print(f"   è¯¦æƒ…: {è¿½è¸ªä¿¡æ¯[:100]}...", flush=True)
        print(flush=True)
        return

    @staticmethod
    def å†³ç­–_å¹³ä»“ä»¤(KOLåç§°, å“ç§):
        """æ”¶åˆ°å¹³ä»“ä»¤"""
        print(f"\n[å¹³ä»“æŒ‡ä»¤]", flush=True)
        print("=" * 80, flush=True)
        print(f"ğŸš¨ [æ”¶åˆ°æ¸…ç›˜ä»¤] {KOLåç§°} è¦æ±‚å¹³ä»“ {å“ç§}", flush=True)
        print("=" * 80 + "\n", flush=True)
        return

    # ================== æ‰§è¡Œç«¯æ—¥å¿— ==================

    @staticmethod
    def æ‰§è¡Œ_æ”¶åˆ°ä»»åŠ¡(KOLåç§°, å“ç§, æ–¹å‘, æ‰‹æ•°, æŒ‚å•ä»·, æ­¢æŸ, æ­¢ç›ˆ):
        """æ‰§è¡Œç«¯æ”¶åˆ°å¾…æ‰§è¡Œä»»åŠ¡"""
        if "ä¹°" in æ–¹å‘:
            æ–¹å‘_æ˜¾ç¤º = "ğŸ“ˆåšå¤š"
        elif "å–" in æ–¹å‘:
            æ–¹å‘_æ˜¾ç¤º = "ğŸ“‰åšç©º"
        else:
            æ–¹å‘_æ˜¾ç¤º = "âŒå¹³ä»“"

        t = datetime.datetime.now().strftime("[%H:%M:%S]")
        print(f"\n{t}", flush=True)
        print("=" * 80, flush=True)
        print(f"ğŸ§‘â€ğŸ’» [{KOLåç§°}] ğŸ’ æŒ‡ä»¤: å¼€ä»“ ğŸŸ¡ç§ç±»:{å“ç§} | {æ–¹å‘_æ˜¾ç¤º}", flush=True)
        return

    @staticmethod
    def æ‰§è¡Œ_ä¸‹å•æˆåŠŸ(å“ç§, Ticket, æ‰‹æ•°, å¼€ä»“ä»·, æ­¢æŸ, æ­¢ç›ˆ):
        """ä¸‹å•æˆåŠŸ"""
        # è¿™é‡Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼Œå¢åŠ æ—¶é—´æˆ³ï¼Œä½†ä¿æŒåŸæœ‰é£æ ¼
        t = datetime.datetime.now().strftime("%H:%M:%S")
        print(f"âœ… [{t}] ä¸‹å•æˆåŠŸ | ğŸ« è®¢å•å·: {Ticket} | å“ç§: {å“ç§}", flush=True)
        print(f"ğŸ“Š å®é™…æˆäº¤: {æ‰‹æ•°:.2f}æ‰‹ | ä»·æ ¼ {å¼€ä»“ä»·:.3f} | ğŸ¯ æ­¢æŸ: {æ­¢æŸ:.3f} | ğŸŸ¢ æ­¢ç›ˆ: {æ­¢ç›ˆ:.3f}", flush=True)
        #print(f"ğŸŸ¢ æ­¢ç›ˆ: {æ­¢ç›ˆ:.3f} | ğŸ¯ æ­¢æŸ: {æ­¢æŸ:.3f}", flush=True)
        #print("=" * 80 + "\n", flush=True)
        return

    @staticmethod
    def æ‰§è¡Œ_ä¸‹å•å¤±è´¥(å“ç§, æ‰‹æ•°, é”™è¯¯ä¿¡æ¯):
        """ä¸‹å•å¤±è´¥"""
        print(f"âŒ [ä¸‹å•å¤±è´¥]", flush=True)
        print(f"   {å“ç§} {æ‰‹æ•°:.2f}æ‰‹ | åŸå› : {é”™è¯¯ä¿¡æ¯}", flush=True)
        print("=" * 80 + "\n", flush=True)
        return

    @staticmethod
    def æ‰§è¡Œ_å•å­ç»“æŸ(KOLåç§°, Ticket, å“ç§, ç›ˆäº, å¼€ä»“ä»·, å¹³ä»“ä»·):
        """å•å­å¹³ä»“"""
        çŠ¶æ€_ç¬¦å· = "ğŸŸ¢" if ç›ˆäº >= 0 else "ğŸ”´"
        çŠ¶æ€_æ–‡æœ¬ = "æ­¢ç›ˆ" if ç›ˆäº > 0 else "æ­¢æŸ" if ç›ˆäº < 0 else "å¹³ä»·"

        print(f"\n[å•å­å®Œæˆ]", flush=True)
        print("=" * 80, flush=True)
        print(f"ğŸ [{KOLåç§°}] {å“ç§} è®¢å•å·: {Ticket}", flush=True)
        print(f"   ğŸ“ˆ å¼€ä»“: {å¼€ä»“ä»·:.4f} | å¹³ä»“: {å¹³ä»“ä»·:.4f}", flush=True)
        print(f"   {çŠ¶æ€_ç¬¦å·} ç›ˆäº: ${ç›ˆäº:+.2f} [{çŠ¶æ€_æ–‡æœ¬}]", flush=True)
        print("=" * 80 + "\n", flush=True)
        return

    @staticmethod
    def æ‰§è¡Œ_ä¿æœ¬è§¦å‘(signal_id, å…„å¼Ÿæ•°):
        """è§¦å‘ä¿æœ¬é€»è¾‘"""
        print(f"ğŸ›¡ï¸ [è§¦å‘ä¿æœ¬] Signal_{signal_id} å·²æœ‰æ­¢ç›ˆ", flush=True)
        print(f"   æ­£åœ¨ä¿æŠ¤å‰©ä½™ {å…„å¼Ÿæ•°} å¼ å•å­...", flush=True)
        return

    @staticmethod
    def æ‰§è¡Œ_ä¿æœ¬æˆåŠŸ(Ticket, æ–°æ­¢æŸä»·):
        """ä¿æœ¬æˆåŠŸ"""
        print(f"   âœ“ Ticket {Ticket} SL ç§»è‡³ {æ–°æ­¢æŸä»·:.4f}", flush=True)
        return

    @staticmethod
    def æ‰§è¡Œ_å¯åŠ¨å®Œæˆ():
        """æ‰§è¡Œç«¯å¯åŠ¨å®Œæˆ"""
        print("\n" + "=" * 80, flush=True)
        print("âš”ï¸ æ‰§è¡Œç«¯ (ç‹™å‡»æ‰‹) å·²å°±ä½", flush=True)
        print("ğŸ‘€ æ­£åœ¨æ‰«æå‘½ä»¤é˜Ÿåˆ— & ç›‘æ§æŒä»“...", flush=True)
        print("=" * 80 + "\n", flush=True)
        return

    @staticmethod
    def æ‰§è¡Œ_é”™è¯¯(é”™è¯¯ä¿¡æ¯):
        """æ‰§è¡Œé”™è¯¯"""
        print(f"âŒ [æ‰§è¡Œé”™è¯¯] {é”™è¯¯ä¿¡æ¯}\n", flush=True)
        return


# ===========================
# å¿«æ·è°ƒç”¨
# ===========================
æ‰“å°å™¨ = äº¤æ˜“æ—¥å¿—æ‰“å°å™¨()