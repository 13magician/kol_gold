# 📈 KOL Index Auto-Trader (KOL 指数自动跟单系统)

> **"不生产信号，只是信号的搬运工。"**

## 📖 项目简介 (Introduction)

本项目旨在构建一个 **KOL 综合指数 (KOL Index)**。
类似于“上证指数”或“纳斯达克指数”，本系统并不依赖单一来源，而是聚合了多个高胜率、付费级 KOL 的交易策略，形成一个更稳健的投资组合。

### 核心机制
* **信号搬运工**：全自动监听并搬运目标 KOL 的交易指令（开仓/平仓/止损）。
* **优胜劣汰 (Survival of the Fittest)**：系统内部维护动态名单，根据 KOL 的实战表现定期调整权重或剔除表现不佳者。
* **人机协作 (Human-in-the-Loop)**：
    * 日常运行：100% 全自动搬运。
    * 人工介入：仅在触发止盈目标，或判断市场环境极端恶劣（"看着实在不行"）时，才介入进行手动平仓或暂停。

---

## 🏗️ 系统架构 (System Architecture)

本系统由五个核心模块组成，各司其职，协同工作：

### 1. 👂 监听端 (`telegram.py`)
* **职责**: 系统的“耳朵”。监听 Telegram 群组，过滤白名单 KOL，提取消息内容（文本+图片），并补充上下文（Reply）。
* **输出**: 将清洗后的原始数据发送给 AI 大脑。

### 2. 🧠 AI 大脑 (`AI_brain.py`)
* **职责**: 系统的“大脑”。接收原始消息，调用 LLM (GPT/Gemini) 进行意图识别。
* **核心能力**:
    * **多模态分析**: 同时理解文本和 K 线图。
    * **意图判断**: 区分是开仓 (ENTRY)、平仓 (EXIT)、保本 (SET_BE) 还是闲聊。
    * **风控过滤**: 识别盈亏比 (R:R) 是否合理，拦截反直觉的“陷阱单”。
    * **个性化**: 根据不同 KOL 的性格（如是否喜欢分批止盈）调整解析策略。
* **输出**: 生成标准化的交易指令 JSON。

### 3. ⚔️ 执行端 (`execution_server.py`)
* **职责**: 系统的“双手”。接收标准指令，执行具体的交易所操作。
* **功能**:
    * **动态杠杆**: 根据止损距离自动计算安全杠杆。
    * **DCA 执行**: 支持分批挂单策略。
    * **智能平仓**: 根据配置比例执行部分止盈或全平。
    * **权限管理**: 确保只有开仓的 KOL (或管理员) 才有权平仓。

### 4. 📊 审计端 (`统计端.py`)
* **职责**: 系统的"记账员"。
* **功能**:
    * **实时监控**: 每 5 秒扫描一次持仓变化。
    * **战役归档**: 将一系列买卖操作聚合为一场"战役"，计算最终盈亏和 ROE。
    * **自动保本**: 检测到部分止盈后，自动触发保本逻辑。

### 5. 🖥️ 监控台 (`dashboard.py`)
* **职责**: 系统的“脸面”。基于 Streamlit 的 Web 界面。
* **展示**: 实时持仓、KOL 战绩排行榜、历史信号流、账户资金曲线。

---

## 🚨 风险与配置警告 (Critical Warnings) - **必读**

**在使用本系统实盘资金之前，请务必阅读以下内容。此处包含极高风险的个人化设置！**

### 1. ⚠️ 极强的个人风格与“硬编码” (Hardcoding Bias)
本系统的代码逻辑并非“通用型”工具，而是完全服务于**开发者个人的财务状况和交易习惯**。很多参数是基于我个人账户情况“硬编码”的。

> **🛑 典型排雷案例 (高危示例)**：
> * **背景**：我个人的 Bitget 账户资金仅为 OKX 账户的 **20%**。
> * **魔改逻辑**：为了让两边的最终下单价值保持一致，我在 `execution_server.json` 中设置了一个 **4倍 (4x) 的金额放大系数**。
> * **后果**：如果你的 Bitget 和 OKX 资金量相等，直接运行此配置会导致你的 Bitget **下单金额瞬间放大 4 倍**，可能导致瞬间爆仓。

**请务必地毯式检查配置文件！** 类似这种基于我个人偏好的隐蔽设置可能不止一处，请在 AI 辅助下逐行确认逻辑。

### 2. 建议小资金测试
初次使用推荐用**小号**或**极小资金**跑通流程。

---

## 🛡️ 安全协议 (Security Protocol)

**严禁将 `key.json` 上传至 GitHub 或任何公开网络！**

为了保护您的资金安全，本项目采用了严格的凭证隔离策略：

1.  **配置文件**：所有的 API Key、Secret 以及私有风控参数都存储在 `key.json` 文件中。
2.  **Git 忽略**：该文件已被加入 `.gitignore`，**请勿强制提交**。
3.  **分发方式**：
    * 由于每位用户的仓位参数和交易所 Key 都不同，该文件不包含在代码库中。
    * 请使用私下分发的模板，或根据 `key_template.json`（如有）在本地创建。
    * 创建 API Key 时只勾选交易，**不要勾选提现功能！**
    * **一旦泄露，请立即前往交易所删除并重置 API Key。**

---

## 📡 信号源与环境配置 (Signal Source & Setup)

**目前监听渠道已从 Discord 全面迁移至 Telegram。**

### 1. 监听目标
请确保你的账号已加入以下用于监听的 Telegram 频道/群组：
> **[https://t.me/+gVBApT2Lb_0xZDM9](https://t.me/+gVBApT2Lb_0xZDM9)**

### 2. 获取 Telegram API
运行本项目需要你申请 Telegram 的 `API ID` 和 `API Hash`。
* **申请教程**：直接询问 AI（如 ChatGPT/Gemini）：“如何申请 Telegram API？”
* **⚠️ 避坑指南**：Telegram 官方申请页面经常会在最后一步报错卡住。
    * **解决方案**：不要浪费时间纠结，**直接去闲鱼花 10 块钱找人解决即可**，省时省力。

### 3. 环境配置
将所有代码文件下载到本地后，请确保 `key.json` 位于根目录，并填入正确的参数（含 TG API 和 交易所 Key）。

---

## 🤖 AI 辅助运行指南 (AI Pair Programming)

为了降低上手门槛，建议把本项目当作一个单纯的代码库，具体操作完全依赖 AI 指导。

**最佳投喂步骤 (Step-by-Step):**

1.  **准备文件**：找到所有的 `.py` 脚本和其他相关文件。
2.  **静默上传 (关键技巧)**：
    * 分批将文件上传给 AI 助手（如 Gemini, ChatGPT）。
    * **让 AI 闭嘴**：在上传过程中，务必告诉 AI **“只读取文件，不要分析，不要回复，直到我说‘发送完毕’。”**
    * *理由*：防止 AI 在只看到一部分代码时就开始胡乱分析，导致上下文混乱。
3.  **正式提问**：
    * 当所有文件传完后，输入指令：“**文件发送完毕。请阅读以上所有代码，根据我的 `key.json` 配置，教我如何启动这个系统，并说明各个文件的作用。**”

**模型推荐 (Tips):**
推荐使用 **Gemini 1.5 Pro/Flash** 或更高版本。
* **理由**：逻辑推理能力强，适合处理复杂的交易信号判断。
* **成本提示**：目前第三方渠道（如闲鱼）成本极低，性价比极高。

---

## ⚖️ 免责声明 (Disclaimer)

* **风险提示**：加密货币交易具有极高的风险，可能导致资金全额损失。
* **仅供参考**：本软件仅作为自动化执行工具，不构成任何投资建议。
* **责任自负**：使用者需自行承担因软件故障、网络延迟、交易所 API 变动、KOL 信号错误或代码中隐含逻辑差异导致的任何资产损失。

---
*Last Updated: 2026*
